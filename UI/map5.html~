<html>
<head>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript"> 

var mapParamArr = [];

google.load("visualization", "1", {packages:["map"]});
google.setOnLoadCallback(getMapParam);

function updataMap(param){
	mapParamArr.push( param);
	// drawMap(param);
}

function drawMap(param){
	var data = google.visualization.arrayToDataTable(param);
	var map = new google.visualization.Map(document.getElementById('map_div'));
	map.draw(data, {showTip: true});
}

function getMapParam(){
var allResults = [];
var st = "";
    	$.ajax({	
			url:"http://10.2.4.239:8080/HeatMap/test?callback=?",
			timeout:10000,
			async: false,
			type: 'GET',
			dataType: 'jsonp',
			success: function(res){
				var newarr = ['Lat', 'Lon', 'Name'];
				allResults.push(newarr);
				for(i = 0; i<res.result.length; i++){
					var newProb = res.result[i].problem;
					var newEntry = res.result[i].stats;
					for(j=0; j<newEntry.length; j++){
						var thisLoc = newEntry[j].location.locationName;
						var thisLat = newEntry[j].location.latitude;
						var thisLon = newEntry[j].location.longitude;
						
						var innerDabba = [thisLat, thisLon, newProb];
						allResults.push(innerDabba);
						}
				}
				
				var data = google.visualization.arrayToDataTable(allResults);
				var map = new google.visualization.Map(document.getElementById('map_div'));
				map.draw(data, {showTip: true});
			}
		});
    }


$(document).ready(function(){
    var query;
    $("button").click(function(){
          query=$("#query").val();
   	  var geocoder = new google.maps.Geocoder();
//	alert(query);
     	 if (geocoder) {
         geocoder.geocode({ 'address': query }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              //alert(results[0].geometry.location.lat());
		//var data = results[0].geometry.location;
		//data = data.split('(').join('');
		//alert(data);
		$(location).attr('href',"map6.html?lat="+results[0].geometry.location.lat()+"&lon="+results[0].geometry.location.lng());
            } 
            else {
             alert('No results found: ' + status);
            }
         });
      }
});
});


   </script> 

</head>

<body>
<form name="form2">
<select name="jumpmenu" onChange="jumpto(document.form2.jumpmenu.options[document.form2.jumpmenu.options.selectedIndex].value)">
<option>Jump to...</option>
<option value=map5.html>All Problems</option>
<option value=map1.html>Electricity Problems</option>
<option value=map2.html>Water Problems</option>
<option value=map3.html>Sewage Problems</option>
<option value=map4.html>Other Problems</option>
</select>
</form>
<div id="map_div" style="width: 1000px; height: 750px"></div>
<input type="text" id="query" /><button>Region Search</button>
<div id="results"></div>

</body>
</html>
